\documentclass[acmsmall]{acmart}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[british]{babel}

\usepackage{mathtools}
\usepackage{mathpartir}
\usepackage[all,cmtip]{xy}
\usepackage{bussproofs}
\EnableBpAbbreviations

\usepackage{xfrac,xspace}
\usepackage{xcolor}
\usepackage{subcaption}
\usepackage{hyperref}
\usepackage[capitalise,noabbrev]{cleveref}
\usepackage[inline]{enumitem} % for environment enumerate*

\usepackage[draft]{fixme}
\usepackage{subfiles}

\usepackage{microtype}

\input{macros}

\FXRegisterAuthor{LT}{LTan}{L-T}
\FXRegisterAuthor{Josh}{Joshan}{Josh}

\citestyle{acmauthoryear}

\begin{document}

\author{Liang-Ting Chen}
\email{liang.ting.chen.tw@gmail.com}
\orcid{0000-0002-3250-1331}
\author{Hsiang-Shang Ko}
\orcid{0000-0002-2439-1048}
\email{joshko@iis.sinica.edu.tw}

\affiliation{%
  \institution{Academia Sinica}
  \streetaddress{128 Academia Road}
  \city{Taipei}
  \country{Taiwan}
  \postcode{115}
}

\title{A Formal Theory of Bidirectional Typing for Simple Types}

\begin{abstract}
  This paper proposes a formal theory of bidirectional typing.
\end{abstract}

\maketitle
\section{Introduction}

\subsection{Related work}

\subsubsection{Language formalization and its frameworks}
\cite{Wadler2022}
PoplMark Challenge~\citep{Aydemir2005}

\cite{Cimini2020,Cimini2022}
\citep{Fiore2022}
\cite{Allais2021,Gheri2020,Ahrens2022}

\subsubsection{Algebraic theory of type theories}
\cite{Fiore1999,Fiore2022,Hamana2022,Ahrens2021,Arkor2020}


\subsubsection{Type checker generation}
\cite{Gast2004,Grewe2015,Pacak2020,Cimini2020}

\subsubsection{Bidirectional typing}
\cite{Dunfield2021}

\subsection{Plan and Contributions of this paper}

\section{Bidirectional simply typed \texorpdfstring{$\lambda$}{lambda}-calculus}
\subsection{Type Checking via Bidirectional Typing}
\subsection{Formalisation in \Agda}

\section{A Definition of Simple Type Theories}
\subsection{Simple Types}
\begin{definition}
  A \emph{(simple type) signature} is a set $I$ with an \emph{arity} $\mathit{ar}_i : \mathbb{N}$ associated to each $i : I$.
  An element $i : I$ is meant to be the \emph{$i$-th operation} $\tyop{i}$ and $\mathit{ar}(i)$ the \emph{number} of arguments of $\tyop{i}$.
\end{definition}
\LTnote{Define $\mathsf{Type}$}
\begin{figure}
  \begin{subfigure}{.5\textwidth}
    \begin{mathpar}
      \boxed{\Theta\vdash A} \\
      \inferrule{\Theta \ni X_i}{\Theta \vdash X_i} \and
      \inferrule{\Theta \vdash A_1 \\ \cdots \\ \Theta \vdash A_n}{\Theta \vdash \tyop{i}(A_1, \ldots, A_n)}
    \end{mathpar}
  \end{subfigure}
  \begin{subfigure}{.4\textwidth}
    \begin{mathpar}
      \boxed{\Theta \vdash \Gamma} \\
      \inferrule{ }{\Theta \vdash \emptyset}\and
      \inferrule{\Theta \vdash A \\ \Theta\vdash \Gamma}{\Theta \vdash \Gamma, A}
    \end{mathpar}
  \end{subfigure}
  \caption{Simple types and contexts}
\end{figure}

\begin{example}[STLC]
  
\end{example}


\subsection{Binding Signatures and Intrinsically Typed Terms}
\begin{definition}
  For a type signature, a \emph{binding signature} consists of a set $J$ meant to be the set of term constructs $\op{j}$ with a triple $\left(\Xi_j, A_{0, j}, \left[\left(\Delta_{1, j}, A_{1, j}\right), \ldots, \left(\Delta_{n_j, j}, A_{n_j, j}\right) \right]\right)$ for each $j:J$ where
  \begin{enumerate}
    \item $\Xi_j : \mathbb{N}$ is the number of variables, 
    \item $A_{0, j} : \mathsf{Type}(\Xi_j)$ is the type of its target,  and
    \item $\left[\left(\Delta_{1, j}, A_{1, j}\right), \ldots, \left(\Delta_{n_j, j}, A_{n_j, j}\right) \right]$ is a finite sequence of pairs of a context $\Delta_{k, j} : \mathsf{Cxt}(\Xi_j)$ for types of its binding variables and its type $A_{k, j} : \mathsf{Type}(\Xi_j)$.
  \end{enumerate}
\end{definition}
\begin{figure}
  \centering
  \begin{mathpar}
    \boxed{\Theta \mid \Gamma \vdash t : A} 
    \quad\text{where $\Theta \vdash \Gamma$ and $\Theta \vdash A$} \\
    \inferrule{\Gamma \ni (x : A)}{\Theta \mid \Gamma \vdash \term{x} : A}\;(\text{var})
    \and
    \inferrule{\Theta \mid \Gamma, \simsub{\Delta_{1,j}}{\rho} \vdash \term{t_1} : \simsub{A_{1,j}}{\rho} \\ \cdots \\ \Theta \mid \Gamma, \simsub{\Delta_{n_j, j}}{\rho} \vdash \term{t_{n}} : \simsub{A_{n, j}}{\rho}} {\Theta \mid \Gamma \vdash \term{\op{j}(\rho; t_1, \ldots, t_{n_j})} : \simsub{A_{0,j}}{\rho}}\;(\text{op})
    \quad \text{where $\rho \colon \Xi_j \to \Theta$}
  \end{mathpar}
  
  \caption{Typing rules}
\end{figure}

\begin{example}[STLC]
  
\end{example}

\section{Definitions of Bidirectional Simple Type Systems} 

\subsection{Bidirectional Binding Signatures}

\begin{definition}
  
\end{definition}


\begin{example}
  
\end{example}

\subsection{Bidirectionally Typed Terms: Intrinsic Typing vs.\ Extrinsic Typing}

\subsubsection{Intrinsically Typed Terms}

\subsubsection{Raw Terms}

\begin{figure}
  \caption{Bidirectional raw terms}
\end{figure}

\subsubsection{Extrinsically Typed Terms}

\begin{figure}
  \centering
  \begin{mathpar}
    \boxed{\Theta \mid \Gamma \vdash \term{t} \Rightarrow A} \quad\text{and}\quad\boxed{\Theta \mid \Gamma \vdash \term{t} \Leftarrow A} \quad
    \text{where $\Theta \vdash \Gamma$ and $\Theta \vdash A$}\\
    \inferrule{\Gamma \ni (\term{x} : A)}{\Theta \mid \Gamma \vdash \term{x} \mathrel{\color{red}\Rightarrow} A}\;(\text{var}{\Rightarrow})
    \and
    \inferrule{\Theta\mid \Gamma \vdash \term{t} \Rightarrow B \\ A = B}{\Theta \mid \Gamma \vdash (\term{t} : B) \Rightarrow A}\;(\textcolor{red}{anno})
    \and
    \inferrule{\Theta\mid \Gamma \vdash \term{t} \Rightarrow B \\ A = B}{\Theta \mid \Gamma \vdash \term{t\uparrow} \Leftarrow A}\;(\textcolor{red}{sub})
    \and
    \inferrule{\Theta \mid \Gamma, \simsub{\vec{x}_{1,j} : \Delta_{1, j}}{\rho} \vdash \term{t_{1, j}} \mathrel{\color{red}\leftrightarrows_{1, j}} \simsub{A_{1, j}}{\rho} \\ \cdots \\ \Theta \mid \Gamma, \simsub{\vec{x}_{n_j, j} : \Delta_{n_j, j}}{\rho} \vdash \term{t_{n_j, j}} \mathrel{\color{red}\leftrightarrows_{n_j, j}} \simsub{A_{n_j ,j}}{\rho}}
    {\Theta \mid \Gamma \vdash \term{\op{j}(\rho; \vec{x}_{1, j} .\, t_{1, j}, \ldots, \vec{x}_{n_j, j}.\, t_{n_j, j})} \mathrel{\color{red}\leftrightarrows_{0, j}} \simsub{A_{0, j}}{\rho}} \; (\text{op}{\leftrightarrows})
    \quad \text{where $\rho \colon \Xi_i \to \Theta$}
  \end{mathpar}
  \caption{Bidirectional typing rules}
\end{figure}

\begin{example}
  
\end{example}


\subsection{Binding Signatures vs.\ their Bidirectional Variants}
\subsubsection{Soundness}
\subsubsection{Completeness (Annotatability)}
\subsection{Mode Correctness}

\section{Bidirectional Type Synthesis and Checking}
\subsection{Substitution Properties}
\subsection{Generic First-Order Unification}
\cite{McBride2003,McBride2003a}
\subsection{Uniqueness of Synthesis}

\subsection{Type Synthesis and Checking with Unification}

\section{Formal Implementation with Examples}

\citep{Xie2018}

\section{Future Work}
\begin{acks}
We thank Nathanael Arkor for the useful conversation and to thank the Programming Languages and Formal Methods Laboratory at Academia Sinica for the opportunity of sharing earlier ideas.

The work is supported by the Ministry of Science and Technology of Taiwan under grant MOST 109-2222-E-001-002-MY3.
\end{acks}

\bibliographystyle{ACM-Reference-Format}

\IfFileExists{reference.bib}{%
  \bibliography{reference}
}{\bibliography{ref}}

\end{document}
