\documentclass[orivec,envcountsect,envcountsame]{llncs}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[british]{babel}
\usepackage[numbers,sort&compress]{natbib}

\usepackage{soul}
\usepackage{subfiles}
\usepackage{xurl} % allow line breaks anywhere in a URL string
\usepackage[colorlinks,urlcolor=blue,citecolor=blue]{hyperref}

\usepackage{bbold}
\newcommand{\hmmax}{0}
\newcommand{\bmmax}{0}
\usepackage{bm}
\usepackage{mathtools}
\input{mathlig}
\usepackage{mathpartir}

\usepackage{xspace}
\usepackage[capitalise,noabbrev]{cleveref}


% Used for typesetting Agda code
\usepackage{agda-lhs2tex}
\newcommand{\cons}[1]{\mathbf{#1}}
\newcommand{\iden}{\mathit}

\usepackage{xifthen}
\newcommand{\varcitet}[3][]{\citeauthor{#2}#3~\ifthenelse{\isempty{#1}}{\cite{#2}}{\cite[#1]{#2}}}

\usepackage[inline]{enumitem} % for environment enumerate*
\newlist{inlineenum}{enumerate*}{1}
\setlist[inlineenum]{label=(\roman*)}

\setlength{\marginparwidth}{2cm}
\usepackage[color=yellow,textsize=scriptsize]{todonotes}

\usepackage{microtype}
\microtypesetup{babel}

\SetSymbolFont{stmry}{bold}{U}{stmry}{m}{n}

\newcommand{\LT}[2][]{\todo[author=LT,color=orange!40,#1]{#2}}
\newcommand{\Josh}[2][]{\todo[author=Josh,color=yellow!40,#1]{#2}}

\newcommand{\codefigure}{\small\setlength{\parindent}{0em}\setlength{\mathindent}{0em}\setlength{\abovedisplayskip}{0ex}\setlength{\belowdisplayskip}{0ex}}

\input{type-notation} %% for type theory notation copied from HoTT Book
\input{macros}

\numberwithin{table}{section}

\spnewtheorem{defn}[theorem]{Definition}{\bfseries}{\rmfamily}
\crefformat{defn}{Definition~#2#1#3}


\author{Liang-Ting Chen
\orcidID{0000-0002-3250-1331}
\and 
Hsiang-Shang Ko
\orcidID{0000-0002-2439-1048}}

\institute{Institute of Information Science, Academia Sinica, Taiwan}

\title{A formal treatment of bidirectional typing\texorpdfstring{\thanks{The work is supported by the National Science and Technology Council of Taiwan under grant NSTC 112-2221-E-001-003-MY3.}}{}}


\begin{document}

\maketitle

\begin{abstract}
There has been much progress in designing bidirectional type systems and associated type synthesis algorithms, but mainly on a case-by-case basis.
%This situation is in stark contrast to parsing, for which there have been general theories and widely applicable tools such as parser generators.
To remedy the situation, this paper develops a \emph{general} and \emph{formal} theory of bidirectional typing and as a by-product of our formalism provides a \emph{verified} generator of \emph{proof-relevant} type synthesisers for simply typed languages: for every signature that specifies a mode-correct bidirectionally typed language, there exists a proof-relevant type synthesiser that for an input abstract syntax tree constructs a typing derivation if any, gives its refutation if not, or reports that the input does not have enough type annotations.
Soundness, completeness, and mode-correctness are studied universally for all signatures, which are sufficient conditions for deriving a type synthesiser.
We propose a preprocessing step called \emph{mode decoration}, which helps the user to deal with missing type annotations in a given abstract syntax tree.
The entire development is formalised in \Agda and can be further integrated with other language-formalisation frameworks.
\end{abstract}

\input{S1-intro}
\input{S2-outline}
\input{S3-defs.tex}
\input{S4-pre-synthesis}
\input{S5-synthesis}
\input{S6-example}
\input{S8-future}

\bibliographystyle{splncs04nat}
\bibliography{ref}

\appendix

\subfile{S7-formalisation}
\input{appendix}

\end{document}
