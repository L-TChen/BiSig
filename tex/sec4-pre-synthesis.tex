%!TEX root = BiSig.tex

\section{Soundness, Completeness, and Mode Preprocessing}\label{sec:pre-synthesis}

\subsection{Soundness and Completeness}

\Josh{$\frac{2}{3}$~pages}

\begin{theorem}[Soundness]\label{thm:term-soundness}
    
\end{theorem}

\begin{theorem}[Completeness]\label{thm:term-completeness}
    
\end{theorem}

\begin{theorem}[Typing Erasure]\label{thm:typing-erasure}
    
\end{theorem}

\subsection{Bidirectionalisation}

\Josh{($1\frac{1}{2}$~pages)

• Generalised mode derivations and bidirectionalisation

• Decidability of the original mode judgements

}

\begin{proposition}[Decidability for Bidirectionalisation] \label{thm:bidirectionalisation}
  It is decidable whether a raw term~$\isTerm{t}$ is in mode~$d$ for any $\isTerm{t}$ and $d$.
\end{proposition}

\subsection{Annotatability is not Completeness}

\Josh{$\frac{1}{2}$~pages}

\begin{figure}
  \centering
  \small
  \bgroup
  \renewcommand{\arraystretch}{1.5}
  \begin{tabular}{ r l }
    $\boxed{|-_{\Sigma, \Omega} \isTerm{t}\;\dir{d}}$ & $\isTerm{t}$ is a raw term possibly with missing annotation or redundant casts in mode $d$ \\
    $\boxed{|-_{\Sigma, \Omega} \isTerm{t}\;\dir{d}}$ & $\isTerm{t}$ is a raw term without missing annotation \\
    $\boxed{|-_{\Sigma, \Omega} \isTerm{t}\;\dir{d}}$ & $\isTerm{t}$ is a raw term without redundant casts \\
  \end{tabular}
  \egroup
  \LT{Design a notation for \textsf{Pre?} so that a raw term without missing annotation or redundant casts is exactly the intersection of these two cases.}
  \begin{mathpar}
    \inferrule{|-_{\Sigma, \Omega}\isTerm{t}^{\chk}}{|-_{\Sigma, \Omega} \isTerm{t}^{\syn}}\,\SynRule{Anno?}
    \and
    \inferrule{\isTerm{x} : \Identifier}{|-_{\Sigma, \Omega} \isTerm{x}^{\syn}}
    \and
    \inferrule{|-_{\Sigma, \Omega}\isTerm{t}^{\chk}}{|-_{\Sigma, \Omega} (\isTerm{t \annotate A})^{\syn}}
    \and
    \inferrule{|-_{\Sigma, \Omega} \isTerm{t}^{\syn}}{|-_{\Sigma, \Omega} \isTerm{t}^{\chk}}
    \and
    \inferrule{|-_{\Sigma, \Omega} \isTerm{t_1}^\dir{d_1} \quad \cdots \quad |-_{\Sigma, \Omega} \isTerm{t_n}^\dir{d_n}}
    {|-_{\Sigma, \Omega} \tmOpts^\dir{d}}
  \end{mathpar}
  \caption{Preprocessed raw terms, II}
  \label{fig:raw-with-missing-annotations}
\end{figure}

\begin{figure}
  \centering\small
  \judgbox{\isTerm{t} \sqsupseteq \isTerm{u}}{A raw term $t$ is more annotated than $u$ (for some bidirectional type system $(\Sigma, \Omega)$)}
  \begin{mathpar}
    \inferrule{\isTerm{t} \sqsupseteq \isTerm{u}}
              {(\isTerm{t} \annotate A) \sqsupseteq \isTerm{u}}\;\Rule{More}
    \and
    \inferrule{\vphantom{x : \Identifier}}
              {\isTerm{x} \sqsupseteq \isTerm{x}}
    \and
    \inferrule{\isTerm{t} \sqsupseteq \isTerm{u}}
              {(\isTerm{t} \annotate A) \sqsupseteq (\isTerm{u} \annotate A)}
    \and
    \inferrule{\isTerm{t_1} \sqsupseteq \isTerm{u_1} \quad \cdots \quad \isTerm{t_n} \sqsupseteq{u_n}}
              {\tmOpts \sqsupseteq \tmOpus}
  \end{mathpar}
  
  \caption{Annotation ordering between raw terms}
  \label{fig:annotation-order}
\end{figure}

